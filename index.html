<!DOCTYPE html>
<html lang="ms-MY">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kemahiran Pemulihan: Anu Tambah dan Tolak (1‚Äì1000)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { box-sizing: border-box; }
    .activity-card { min-height: 400px; }
    .number-card { transition: all .3s ease; cursor: pointer; }
    .number-card:hover { transform: scale(1.05); }

    /* Animasi */
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
    .shake { animation: shake 0.5s ease; }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: .5; }
    }
    .pulse-once { animation: pulse 0.6s 1; }
    
    /* Gaya Aktiviti 4 (Token) */
    .token-on { outline: 3px solid #A78BFA; }
    .token-bad { outline: 3px solid #F87171; }
    .result-good { background: #dcfce7; outline: 3px solid #22c55e; }

    /* Gaya Asas Input/Display */
    .num-input {
      width: 120px; text-align: center; font-weight: bold;
      font-size: 1.5rem; padding: 0.5rem; border-width: 2px;
      border-radius: 0.5rem;
    }
    .num-display {
      min-width: 120px; min-height: 62px; 
      padding: 0.5rem 1rem; border-width: 2px;
      border-radius: 0.5rem; font-weight: bold;
      font-size: 1.5rem; background-color: #f3f4f6;
      display: inline-flex; align-items: center; justify-content: center;
    }
    .op-symbol {
      font-size: 2.25rem; font-weight: bold;
      color: #4b5563; margin: 0 0.5rem;
    }

    /* CSS Aktiviti 3 - Tangki Air */
    .tank-container {
      width: 200px;
      height: 300px;
      border: 5px solid #6b7280;
      border-top: none;
      background-color: #f3f4f6;
      margin: 0 auto 1rem auto;
      position: relative;
      overflow: hidden;
    }
    .water-level {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #60a5fa;
      transition: height 0.5s ease;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      color: #1e3a8a;
      font-weight: bold;
      font-size: 1.5rem;
      padding-bottom: 5px;
    }
    .level-marker {
      position: absolute;
      left: 100%;
      width: 120px;
      margin-left: 10px;
      border-bottom: 2px dashed #4b5563;
      padding-left: 5px;
      font-size: 0.9rem;
      font-weight: bold;
      color: #374151;
    }
    
    /* CSS Aktiviti 5 - Mesin Songsang */
    .machine-box {
      width: 100px; /* dikecilkan sikit */
      height: 100px;
      border: 4px solid #6b7280;
      background: #f3f4f6;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      color: #1f2937;
      transition: all 0.3s ease;
    }
    .machine-box.anu {
      color: #dc2626; /* red */
      border-style: dashed;
      border-color: #ef4444;
      background: #fee2e2;
    }
    .machine-box.result {
      color: #166534; /* green */
      border-color: #22c55e;
      background: #dcfce7;
    }
    .machine-op {
      min-width: 90px;
      text-align: center;
      font-size: 1.25rem;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .machine-arrow {
      font-size: 2.5rem;
      color: #9ca3af;
      margin: 0 0.5rem;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-full">

  <div class="bg-yellow-100 border-b-4 border-yellow-300 p-4 shadow-sm sticky top-0 z-10">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-2xl">üìö</span>
        <span id="info-text" class="text-lg font-semibold text-gray-800">
          Pilih aktiviti untuk mula belajar 'anu'!
        </span>
      </div>
      <button id="speak-btn"
              class="bg-yellow-300 hover:bg-yellow-400 text-yellow-800 font-bold py-2 px-4 rounded-full text-xl transition-colors duration-200"
              onclick="speakInfo()">
        üîä
      </button>
    </div>
  </div>

  <div class="max-w-6xl mx-auto p-6">
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 activity-card flex items-center justify-center">
      <div id="activity-content" class="text-center w-full">
        <div class="py-16">
          <div class="text-6xl mb-4">üßÆ</div>
          <h2 class="text-3xl font-bold text-gray-800 mb-4">
            Kemahiran Pemulihan: Anu Tambah dan Tolak (1‚Äì1000)
          </h2>
          <p class="text-xl text-gray-600 mb-8">
            Pilih aktiviti di bawah untuk meneroka 'anu' (nombor yang tidak diketahui).
          </p>
          <div class="text-4xl">üëá</div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">Pilih Aktiviti</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-6">
        <button onclick="loadActivity(1)"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          üîç Cari 'Sebahagian' (A+?=C)
        </button>
        <button onclick="loadActivity(2)"
                class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          üìè Garis Nombor (C-?=A)
        </button>
        <button onclick="loadActivity(3)"
                class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          üíß Isi Tangki (?-A=B)
        </button>
        <button onclick="loadActivity(4)"
                class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          ‚öñÔ∏è Penimbang (A+B=?+D)
        </button>
        <button onclick="loadActivity(5)"
                class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors duration-200">
          ü§ñ Mesin Songsang
        </button>
      </div>
      
      <div class="flex justify-center gap-4">
        <button onclick="clearActivity()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg text-lg transition-colors duration-200">
          üßπ Bersih
        </button>
        <button onclick="nextActivity()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg text-lg transition-colors duration-200">
          ‚û°Ô∏è Seterusnya
        </button>
      </div>
    </div>
  </div>

  <script>
    let currentActivity = 0;
    let ttsEnabled = false;
    let currentInfo = "Pilih aktiviti untuk mula belajar 'anu'!";

    /* ====== TTS ====== */
    function speak(text) {
      if (!ttsEnabled) return;
      if (!('speechSynthesis' in window)) return;
      window.speechSynthesis.cancel();
      setTimeout(() => {
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ms-MY';
        u.rate = 0.9; u.pitch = 1.05;
        const voices = window.speechSynthesis.getVoices();
        const ms = voices.find(v => v.lang === 'ms-MY' || v.lang?.startsWith('ms'));
        if (ms) u.voice = ms;
        window.speechSynthesis.speak(u);
      }, 100);
    }
    function setInfo(text) { currentInfo = text; document.getElementById('info-text').textContent = text; }
    function speakInfo() {
      if (!ttsEnabled) {
        ttsEnabled = true;
        const btn = document.getElementById('speak-btn');
        btn.classList.add('bg-green-300', 'hover:bg-green-400');
        btn.classList.remove('bg-yellow-300', 'hover:bg-yellow-400');
      }
      speak(currentInfo);
    }
    
    // Helper penjana nombor
    const r = (min,max) => Math.floor(Math.random()*(max-min+1))+min;

    /* ====== Router ====== */
    function loadActivity(n) {
      currentActivity = n;
      const content = document.getElementById('activity-content');
      if (n === 1) return loadActivity1(content);
      if (n === 2) return loadActivity2(content);
      if (n === 3) return loadActivity3(content);
      if (n === 4) return loadActivity4(content);
      if (n === 5) return loadActivity5(content);
    }

    /* ====== Aktiviti 1: Cari 'Sebahagian' (A+?=C) ====== */
    let a1_state = { A: 0, anu: 0, C: 0 };
    function loadActivity1(content) {
      a1_state.A = r(100, 300);
      a1_state.C = r(a1_state.A + 100, 900);
      a1_state.anu = 0;
      setInfo(`Cari 'anu' (?). Guna butang untuk tambah nombor sehingga ${a1_state.A} + ? = ${a1_state.C}.`);
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-blue-600 mb-6">üîç Cari 'Sebahagian' (A + ? = C)</h3>
        <div class="flex flex-wrap items-center justify-center gap-4 mb-6 text-2xl md:text-3xl">
          <div class="num-display border-gray-400">${a1_state.A}</div>
          <span class="op-symbol">+</span>
          <div id="a1-anu" class="num-display border-blue-500 text-blue-800 bg-blue-50" style="min-width: 140px;">${a1_state.anu}</div>
          <span class="op-symbol">=</span>
          <div class="num-display border-gray-400">${a1_state.C}</div>
        </div>
        <div class="flex flex-wrap items-center justify-center gap-3 mb-6">
          <button onclick="adjustAnu1(100)" class="bg-blue-200 text-blue-800 font-bold p-3 rounded-lg">+100</button>
          <button onclick="adjustAnu1(10)" class="bg-blue-200 text-blue-800 font-bold p-3 rounded-lg">+10</button>
          <button onclick="adjustAnu1(1)" class="bg-blue-200 text-blue-800 font-bold p-3 rounded-lg">+1</button>
          <button onclick="adjustAnu1(-1)" class="bg-red-200 text-red-800 font-bold p-3 rounded-lg">-1</button>
          <button onclick="adjustAnu1(-10)" class="bg-red-200 text-red-800 font-bold p-3 rounded-lg">-10</button>
          <button onclick="adjustAnu1(-100)" class="bg-red-200 text-red-800 font-bold p-3 rounded-lg">-100</button>
        </div>
        <div id="a1-feedback" class="text-lg font-semibold text-gray-700 min-h-6">
          Jumlah semasa: ${a1_state.A + a1_state.anu}
        </div>
         <div class="mt-6 flex flex-wrap gap-3 justify-center">
          <button onclick="loadActivity1(document.getElementById('activity-content'))" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-3 rounded-xl">üîÑ Soalan Baharu</button>
        </div>
      `;
    }
    function adjustAnu1(val) {
      a1_state.anu += val;
      if (a1_state.anu < 0) a1_state.anu = 0;
      if (a1_state.A + a1_state.anu > 1000) a1_state.anu -= val;
      
      const anuEl = document.getElementById('a1-anu');
      const feedbackEl = document.getElementById('a1-feedback');
      anuEl.textContent = a1_state.anu;
      
      const currentTotal = a1_state.A + a1_state.anu;
      feedbackEl.textContent = `Jumlah semasa: ${currentTotal}`;
      
      if (currentTotal === a1_state.C) {
        feedbackEl.textContent = `Syabas! ${a1_state.A} + ${a1_state.anu} = ${a1_state.C}.`;
        anuEl.classList.add('bg-blue-300', 'border-blue-600');
        setInfo(`Syabas! Jawapannya ialah ${a1_state.anu}.`);
        speak(`Syabas! ${a1_state.A} tambah ${a1_state.anu} sama dengan ${a1_state.C}.`);
      } else {
        anuEl.classList.remove('bg-blue-300', 'border-blue-600');
        if (currentTotal > a1_state.C) {
          feedbackEl.classList.add('text-red-600');
          feedbackEl.classList.remove('text-gray-700');
        } else {
          feedbackEl.classList.remove('text-red-600');
          feedbackEl.classList.add('text-gray-700');
        }
      }
    }

    /* ====== Aktiviti 2: Garis Nombor (C-?=A) ====== */
    let a2_state = { C: 0, anu: 0, A: 0, current: 0 };
    function loadActivity2(content) {
      a2_state.C = r(500, 900);
      a2_state.A = r(100, a2_state.C - 200);
      a2_state.anu = 0;
      a2_state.current = a2_state.C;
      
      setInfo(`Mula di ${a2_state.C}. Lompat ke belakang sehingga sampai ${a2_state.A}. Berapa jumlah lompatan anda?`);
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-green-600 mb-6">üìè Garis Nombor (C - ? = A)</h3>
        <div class="flex flex-wrap items-center justify-center gap-4 mb-6 text-xl md:text-2xl">
          <div class="num-display border-gray-400">${a2_state.C}</div>
          <span class="op-symbol text-red-500">‚àí</span>
          <div id="a2-anu" class="num-display border-green-500 text-green-800 bg-green-50" style="min-width: 140px;">${a2_state.anu}</div>
          <span class="op-symbol">=</span>
          <div class="num-display border-gray-400">${a2_state.A}</div>
        </div>
        
        <div class="flex flex-wrap items-center justify-center gap-3 mb-4">
          <button onclick="adjustAnu2(100)" class="bg-green-200 text-green-800 font-bold p-3 rounded-lg">-100</button>
          <button onclick="adjustAnu2(10)" class="bg-green-200 text-green-800 font-bold p-3 rounded-lg">-10</button>
          <button onclick="adjustAnu2(1)" class="bg-green-200 text-green-800 font-bold p-3 rounded-lg">-1</button>
        </div>
        <div class="flex flex-wrap items-center justify-center gap-3 mb-6">
          <button onclick="adjustAnu2(-1)" class="bg-gray-200 text-gray-800 font-bold p-3 rounded-lg">+1</button>
          <button onclick="adjustAnu2(-10)" class="bg-gray-200 text-gray-800 font-bold p-3 rounded-lg">+10</button>
          <button onclick="adjustAnu2(-100)" class="bg-gray-200 text-gray-800 font-bold p-3 rounded-lg">+100</button>
        </div>
        
        <div id="a2-feedback" class="text-lg font-semibold text-gray-700 min-h-6">
          Posisi semasa: ${a2_state.current}
        </div>
         <div class="mt-6 flex flex-wrap gap-3 justify-center">
          <button onclick="loadActivity2(document.getElementById('activity-content'))" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-3 rounded-xl">üîÑ Soalan Baharu</button>
        </div>
      `;
    }
    function adjustAnu2(val) {
      a2_state.anu += val;
      a2_state.current = a2_state.C - a2_state.anu;
      
      if (a2_state.current < 0) {
        a2_state.anu -= val;
        a2_state.current = a2_state.C - a2_state.anu;
      }
      
      const anuEl = document.getElementById('a2-anu');
      const feedbackEl = document.getElementById('a2-feedback');
      
      if (!anuEl || !feedbackEl) return;

      anuEl.textContent = a2_state.anu;
      feedbackEl.textContent = `Posisi semasa: ${a2_state.current}`;
      
      if (a2_state.current === a2_state.A) {
        feedbackEl.textContent = `Syabas! ${a2_state.C} - ${a2_state.anu} = ${a2_state.A}.`;
        anuEl.classList.add('bg-green-300', 'border-green-600');
        const msg = `Syabas! Jawapannya ialah ${a2_state.anu}.`;
        setInfo(msg); speak(msg);
      } else {
        anuEl.classList.remove('bg-green-300', 'border-green-600');
        if (a2_state.current < a2_state.A) {
          feedbackEl.classList.add('text-red-600');
          feedbackEl.classList.remove('text-gray-700');
          feedbackEl.textContent = `Posisi semasa: ${a2_state.current}. (Terlajak! Tekan +)`;
        } else {
          feedbackEl.classList.remove('text-red-600');
          feedbackEl.classList.add('text-gray-700');
        }
      }
    }

    /* ====== Aktiviti 3: Isi Semula Tangki Air (?-A=B) ====== */
    let a3_state = { 
      numA: 0, numB: 0, correctTotal: 0, anu: 0, currentLevel: 0 
    };
    const MAX_HEIGHT_PX = 300;
    const MAX_LITERS = 1000;

    function loadActivity3(content) {
      a3_state.numA = r(100, 300);
      a3_state.numB = r(200, 500);
      a3_state.correctTotal = a3_state.numA + a3_state.numB;
      a3_state.anu = 0;
      a3_state.currentLevel = a3_state.numB;
      
      setInfo(`Tangki ada baki ${a3_state.numB} liter. ${a3_state.numA} liter telah digunakan. Isi semula air yang digunakan untuk cari paras asal.`);
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-purple-600 mb-4">üíß Isi Semula Tangki Air (? - A = B)</h3>
        <div class="text-xl md:text-2xl font-bold text-gray-800 mb-4">
          ? <span class="op-symbol text-red-500">‚àí</span> ${a3_state.numA} <span class="op-symbol">=</span> ${a3_state.numB}
        </div>
        <div class="tank-container">
          <div id="a3-water" class="water-level" style="height: ${(a3_state.currentLevel / MAX_LITERS) * MAX_HEIGHT_PX}px;">
             <span id="a3-water-label">${a3_state.currentLevel} L</span>
          </div>
          <div id="a3-target-line" class="level-marker" style="bottom: ${(a3_state.correctTotal / MAX_LITERS) * MAX_HEIGHT_PX - 10}px;">
            Paras Asal (?)
          </div>
          <div class="level-marker" style="bottom: ${(a3_state.numB / MAX_LITERS) * MAX_HEIGHT_PX - 10}px; border-style: solid; color: #064e3b; border-color: #064e3b;">
            Baki (${a3_state.numB} L)
          </div>
        </div>
        <div class="mb-4">
          <div class="text-lg font-semibold">Air Digunakan: <span class="font-bold text-red-600">${a3_state.numA} L</span></div>
          <div class="text-lg font-semibold">Air Diisi Semula: 
            <span id="a3-anu" class="font-bold text-blue-600 text-2xl">${a3_state.anu}</span> L
          </div>
        </div>
        <div class="flex flex-wrap items-center justify-center gap-3 mb-6">
          <button onclick="adjustAnu3(100)" class="bg-blue-200 text-blue-800 font-bold p-3 rounded-lg">+100</button>
          <button onclick="adjustAnu3(10)" class="bg-blue-200 text-blue-800 font-bold p-3 rounded-lg">+10</button>
          <button onclick="adjustAnu3(1)" class="bg-blue-200 text-blue-800 font-bold p-3 rounded-lg">+1</button>
          <button onclick="adjustAnu3(-1)" class="bg-gray-200 text-gray-800 font-bold p-3 rounded-lg">-1</button>
          <button onclick="adjustAnu3(-10)" class="bg-gray-200 text-gray-800 font-bold p-3 rounded-lg">-10</button>
        </div>
        <div id="a3-feedback" class="text-lg font-semibold text-gray-700 min-h-6">
          Isi semula air sehingga ${a3_state.numA} liter.
        </div>
         <div class="mt-6 flex flex-wrap gap-3 justify-center">
          <button onclick="loadActivity3(document.getElementById('activity-content'))" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-3 rounded-xl">üîÑ Soalan Baharu</button>
        </div>
      `;
      renderActivity3();
    }
    function adjustAnu3(val) {
      a3_state.anu += val;
      if (a3_state.anu < 0) a3_state.anu = 0;
      if (a3_state.numB + a3_state.anu > MAX_LITERS) {
        a3_state.anu -= val;
      }
      a3_state.currentLevel = a3_state.numB + a3_state.anu;
      renderActivity3();
    }
    function renderActivity3() {
      const { numA, numB, correctTotal, anu, currentLevel } = a3_state;
      const waterEl = document.getElementById('a3-water');
      const anuEl = document.getElementById('a3-anu');
      const feedbackEl = document.getElementById('a3-feedback');
      const waterLabelEl = document.getElementById('a3-water-label');
      const targetLineEl = document.getElementById('a3-target-line');
      if (!waterEl) return; 

      waterEl.style.height = `${(currentLevel / MAX_LITERS) * MAX_HEIGHT_PX}px`;
      waterLabelEl.textContent = `${currentLevel} L`;
      anuEl.textContent = anu;

      if (anu === numA) {
        const feedbackMsg = `Syabas! <span class="font-bold text-2xl text-purple-700">${correctTotal}</span> - ${numA} = ${numB}.<br>Paras asal ialah ${correctTotal} L!`;
        feedbackEl.innerHTML = feedbackMsg;
        feedbackEl.className = 'text-lg font-semibold min-h-6 text-green-700';
        targetLineEl.innerHTML = `Paras Asal (${correctTotal} L)`;
        targetLineEl.style.color = '#5b21b6';
        targetLineEl.style.borderColor = '#5b21b6';
        anuEl.className = 'font-bold text-green-700 text-2xl';
        const infoMsg = `Syabas! Jawapannya ialah ${correctTotal}, kerana ${correctTotal} tolak ${numA} sama dengan ${numB}.`;
        setInfo(infoMsg);
        speak(`Syabas! Jawapannya ialah ${correctTotal}.`);
      } else if (anu > numA) {
        feedbackEl.textContent = `Oh! Terlebih isi! Air digunakan cuma ${numA} L.`;
        feedbackEl.className = 'text-lg font-semibold min-h-6 text-red-600';
        anuEl.className = 'font-bold text-red-600 text-2xl shake';
        setTimeout(()=>anuEl.classList.remove('shake'), 500);
      } else {
        feedbackEl.textContent = `Isi semula air sehingga ${a3_state.numA} liter.`;
        feedbackEl.className = 'text-lg font-semibold min-h-6 text-gray-700';
        anuEl.className = 'font-bold text-blue-600 text-2xl';
        targetLineEl.innerHTML = `Paras Asal (?)`;
        targetLineEl.style.color = '#374151';
        targetLineEl.style.borderColor = '#4b5563';
      }
    }


    /* ====== Aktiviti 4: Penimbang (A+B=?+D) ====== */
    let a4_state = { numA: 0, numB: 0, numD: 0, leftTotal: 0, correctAnu: 0, currentAnu: 0 };
    function loadActivity4(content) {
      a4_state.numA = r(100, 200);
      a4_state.numB = r(50, 150);
      a4_state.numD = r(50, 100);
      a4_state.leftTotal = a4_state.numA + a4_state.numB;
      a4_state.correctAnu = a4_state.leftTotal - a4_state.numD;
      a4_state.currentAnu = 0;
      setInfo(`Seimbangkan penimbang. Jadikan jumlah di KANAN sama dengan ${a4_state.leftTotal}.`);
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-orange-600 mb-6">‚öñÔ∏è Seimbangkan Penimbang</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 text-center">
            <div class="text-sm uppercase tracking-wide text-blue-600 font-semibold">Sebelah Kiri (SASARAN)</div>
            <div class="text-xl md:text-2xl font-bold text-gray-800 my-2">
              ${a4_state.numA} <span class="op-symbol text-sm">+</span> ${a4_state.numB}
            </div>
            <div class="text-4xl font-black text-blue-800 leading-none">${a4_state.leftTotal}</div>
          </div>
          <div class="bg-orange-50 border-2 border-orange-200 rounded-xl p-6 text-center">
            <div class="text-sm uppercase tracking-wide text-orange-600 font-semibold">Sebelah Kanan (CUBAAN ANDA)</div>
            <div class="text-xl md:text-2xl font-bold text-gray-800 my-2">
              <span id="a4-anu" class="text-orange-800 font-black text-3xl">${a4_state.currentAnu}</span>
              <span class="op-symbol text-sm">+</span> ${a4_state.numD}
            </div>
            <div id="a4-total-right" class="text-4xl font-black text-gray-700 leading-none">
              ${a4_state.currentAnu + a4_state.numD}
            </div>
          </div>
        </div>
        <div id="a4-status" class="text-center text-lg font-semibold p-3 rounded-lg mb-6 bg-yellow-100 text-yellow-800 border border-yellow-300">
          Belum Seimbang. Cuba tambah nilai 'anu'.
        </div>
        <div>
          <div class="text-sm font-semibold text-gray-600 mb-2 text-center">Klik untuk ubah nilai 'anu' (?):</div>
          <div class="flex flex-wrap gap-2 justify-center mb-3">
            ${[100, 10, 1].map(w=>`
              <button onclick="adjustAnu4(${w})" class="number-card bg-green-100 border-2 border-green-300 px-4 py-2 text-lg font-semibold text-green-800 rounded-xl">+${w}</button>
            `).join('')}
          </div>
          <div class="flex flex-wrap gap-2 justify-center">
            ${[-100, -10, -1].map(w=>`
              <button onclick="adjustAnu4(${w})" class="number-card bg-red-100 border-2 border-red-300 px-4 py-2 text-lg font-semibold text-red-800 rounded-xl">${w}</button>
            `).join('')}
          </div>
        </div>
        <div class="mt-8 flex flex-wrap gap-3 justify-center">
          <button onclick="loadActivity4(document.getElementById('activity-content'))" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-3 rounded-xl">üîÑ Soalan Baharu</button>
        </div>
      `;
      renderActivity4(); 
    }
    function adjustAnu4(val) {
      a4_state.currentAnu += val;
      if (a4_state.currentAnu < 0) {
        a4_state.currentAnu = 0;
      }
      if (a4_state.currentAnu + a4_state.numD > 1000) {
         a4_state.currentAnu -= val;
      }
      renderActivity4();
    }
    function renderActivity4() {
      const anuEl = document.getElementById('a4-anu');
      const totalRightEl = document.getElementById('a4-total-right');
      const statusEl = document.getElementById('a4-status');
      if (!anuEl || !totalRightEl || !statusEl) return; 

      const { leftTotal, currentAnu, numD } = a4_state;
      const currentRightTotal = currentAnu + numD;
      anuEl.textContent = currentAnu;
      totalRightEl.textContent = currentRightTotal;
      statusEl.className = 'text-center text-lg font-semibold p-3 rounded-lg mb-6 border';
      totalRightEl.className = 'text-4xl font-black leading-none';

      if (currentRightTotal === leftTotal) {
        statusEl.classList.add('bg-green-100', 'text-green-800', 'border-green-300');
        statusEl.innerHTML = `SEIMBANG! ‚úÖ<br><span class="text-xl">${leftTotal} = <span class="font-bold text-orange-700">${currentAnu}</span> + ${numD}</span>`;
        totalRightEl.classList.add('text-green-700');
        const infoMsg = `Seimbang! Jawapannya ialah ${currentAnu}, kerana ${leftTotal} sama dengan ${currentAnu} tambah ${numD}.`;
        setInfo(infoMsg);
        speak(`Seimbang! ${currentAnu} ialah jawapannya.`);
      } else if (currentRightTotal > leftTotal) {
        statusEl.classList.add('bg-red-100', 'text-red-800', 'border-red-300');
        statusEl.textContent = `Terlebih! Cuba kurangkan nilai 'anu'.`;
        totalRightEl.classList.add('text-red-700');
        setInfo(`Terlebih. Jumlah anda ${currentRightTotal}. Sasaran ialah ${leftTotal}.`);
      } else {
        statusEl.classList.add('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
        statusEl.textContent = `Belum Seimbang. Cuba tambah lagi.`;
        totalRightEl.classList.add('text-gray-700');
         setInfo(`Belum seimbang. Jumlah anda ${currentRightTotal}. Sasaran ialah ${leftTotal}.`);
      }
    }

    /* ====== Aktiviti 5: Mesin Nombor Songsang (Layout Dikemaskini) ====== */
    let a5_state = { 
      type: 'add', opVal: 0, result: 0, correctAnu: 0, reversed: false 
    };
    
    function loadActivity5(content) {
      a5_state.opVal = r(100, 250);
      a5_state.result = r(400, 800);
      a5_state.type = r(0,1) ? 'add' : 'sub';
      a5_state.reversed = false;
      
      let question;
      if (a5_state.type === 'add') {
        a5_state.correctAnu = a5_state.result - a5_state.opVal;
        question = `? tambah ${a5_state.opVal} jadi ${a5_state.result}.`;
      } else {
        a5_state.correctAnu = a5_state.result + a5_state.opVal;
        question = `? tolak ${a5_state.opVal} jadi ${a5_state.result}.`;
      }
      
      setInfo(`Lihat mesin. ${question} Apakah nombor asal (?)? Tekan 'Songsang'.`);
      
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-red-600 mb-6">ü§ñ Mesin Nombor Songsang</h3>
        
        <div class="mb-4">
          <h4 class="text-lg font-semibold text-gray-700 mb-2">SOALAN ASAL:</h4>
          <div class="flex flex-wrap items-center justify-center p-4 bg-gray-50 rounded-lg gap-4 md:gap-8">
            <div id="a5-machine-question" class="flex items-center justify-center">
              </div>
            <div id="a5-equation-question" class="text-2xl font-bold text-gray-700 text-left" style="min-width: 200px;">
              </div>
          </div>
        </div>
        
        <div id="a5-answer-container" class="mt-6 hidden">
          <h4 class="text-lg font-semibold text-green-700 mb-2">JAWAPAN (SONGSANG):</h4>
          <div class="flex flex-wrap items-center justify-center p-4 bg-green-50 rounded-lg gap-4 md:gap-8">
            <div id="a5-machine-answer" class="flex items-center justify-center">
              </div>
            <div id="a5-equation-answer" class="text-2xl font-bold text-green-700 text-left" style="min-width: 200px;">
              </div>
          </div>
        </div>
        
        <div id="a5-feedback" class="text-lg font-semibold text-gray-700 min-h-6 mt-6">
          Tekan butang 'Songsang' untuk mencari jawapan.
        </div>
         <div class="mt-8 flex flex-wrap gap-3 justify-center">
           <button id="a5-songsang-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-3 rounded-xl text-lg">üîÑ Songsang</button>
          <button id="a5-new-btn" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-3 rounded-xl text-lg">üîÑ Soalan Baharu</button>
        </div>
      `;
      
      renderActivity5(); // Panggil untuk lukis mesin
      
      document.getElementById('a5-songsang-btn').onclick = () => {
        a5_state.reversed = true;
        renderActivity5();
      };
      document.getElementById('a5-new-btn').onclick = () => {
        loadActivity5(content);
      };
    }
    
    function renderActivity5() {
      const { type, opVal, result, correctAnu, reversed } = a5_state;
      
      const machineQuestionEl = document.getElementById('a5-machine-question');
      const equationQuestionEl = document.getElementById('a5-equation-question');
      const answerContainerEl = document.getElementById('a5-answer-container');
      const machineAnswerEl = document.getElementById('a5-machine-answer');
      const equationAnswerEl = document.getElementById('a5-equation-answer');
      const feedbackEl = document.getElementById('a5-feedback');
      const songsangBtn = document.getElementById('a5-songsang-btn');
      
      if (!machineQuestionEl) return;
      
      let opChar, revOpChar, questionEq, answerEq;
      
      if (type === 'add') { // ? + 150 = 400
        opChar = `+ ${opVal}`;
        revOpChar = `‚àí ${opVal}`;
        questionEq = `<span class="text-red-600">?</span> + ${opVal} = ${result}`;
        answerEq = `${result} ‚àí ${opVal} = <span class="text-green-700">${correctAnu}</span>`;
      } else { // ? - 150 = 400
        opChar = `‚àí ${opVal}`;
        revOpChar = `+ ${opVal}`;
        questionEq = `<span class="text-red-600">?</span> ‚àí ${opVal} = ${result}`;
        answerEq = `${result} + ${opVal} = <span class="text-green-700">${correctAnu}</span>`;
      }
      
      // 1. Sentiasa paparkan mesin SOALAN dan AYAT MATEMATIK SOALAN
      machineQuestionEl.innerHTML = `
        <div class="machine-box anu">?</div>
        <div class="machine-arrow">‚û°Ô∏è</div>
        <div class="machine-op text-blue-600">(${opChar})</div>
        <div class="machine-arrow">‚û°Ô∏è</div>
        <div class="machine-box">${result}</div>
      `;
      equationQuestionEl.innerHTML = questionEq;
      
      // 2. Kawal paparan mesin JAWAPAN
      if (reversed) {
        answerContainerEl.classList.remove('hidden');
        if(songsangBtn) songsangBtn.disabled = true;
        
        machineAnswerEl.innerHTML = `
          <div class="machine-box">${result}</div>
          <div class="machine-arrow">‚û°Ô∏è</div>
          <div class="machine-op text-red-600">(${revOpChar})</div>
          <div class="machine-arrow">‚û°Ô∏è</div>
          <div class="machine-box result pulse-once">${correctAnu}</div>
        `;
        equationAnswerEl.innerHTML = answerEq;
        
        let concept = (type === 'add') ? "TAMBAH" : "TOLAK";
        // === INILAH RALAT YANG DIBETULKAN ===
        let inverse = (type === 'add') ? "TOLAK" : "TAMBAH";
        // ===================================
        
        feedbackEl.innerHTML = `Syabas! Untuk songsangkan ${concept}, kita guna ${inverse}.<br> Jawapannya ialah <span class="font-bold text-2xl">${correctAnu}</span>.`;
        feedbackEl.className = 'text-lg font-semibold text-green-700 min-h-6 mt-6';
        setInfo(`Syabas! Jawapannya ialah ${correctAnu}.`);
        speak(`Syabas! Jawapannya ialah ${correctAnu}.`);
        
      } else {
        answerContainerEl.classList.add('hidden');
        if(songsangBtn) songsangBtn.disabled = false;
        equationAnswerEl.innerHTML = ""; // Kosongkan ayat matematik jawapan
        feedbackEl.innerHTML = `Tekan butang 'Songsang' untuk mencari jawapan.`;
        feedbackEl.className = 'text-lg font-semibold text-gray-700 min-h-6 mt-6';
      }
    }


    /* ====== Kawalan Umum ====== */
    function clearActivity() {
      currentActivity = 0;
      document.getElementById('activity-content').innerHTML = `
        <div class="text-center py-16">
          <div class="text-6xl mb-4">üßÆ</div>
          <h2 class="text-3xl font-bold text-gray-800 mb-4">Kemahiran Pemulihan: Anu Tambah dan Tolak (1‚Äì1000)</h2>
          <p class="text-xl text-gray-600 mb-8">Pilih aktiviti di bawah untuk meneroka 'anu' (nombor yang tidak diketahui).</p>
          <div class="text-4xl">üëá</div>
        </div>
      `;
      setInfo("Pilih aktiviti untuk mula belajar 'anu'!");
    }
    function nextActivity() {
      if (currentActivity === 0) return loadActivity(1);
      if (currentActivity < 5) return loadActivity(currentActivity + 1);
      return loadActivity(1);
    }

    // Kekalkan TTS resume pada sesetengah pelayar
    if ('speechSynthesis' in window) {
      setInterval(() => { if (window.speechSynthesis.paused) window.speechSynthesis.resume(); }, 1000);
    }
  </script>
</body>
</html>
