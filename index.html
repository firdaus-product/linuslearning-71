<!DOCTYPE html>
<html lang="ms-MY">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kemahiran Pemulihan: Anu Tambah & Tolak</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    /* --- UI STYLE (TEMA HIJAU KONSISTEN) --- */
    body { 
        font-family: 'Fredoka', sans-serif; 
        background-color: #f0fdf4; 
        background-image: radial-gradient(#86efac 2px, transparent 2px); 
        background-size: 30px 30px; 
    }
    
    /* Card Container */
    .game-card { 
        background: white; 
        border: 4px solid #475569; 
        box-shadow: 8px 8px 0px #00000020; 
        border-radius: 1.5rem; 
        min-height: 550px; 
        position: relative;
    }
    
    /* Buttons 3D */
    .btn-3d { 
        transition: all 0.1s; 
        border-bottom-width: 6px; 
        border-color: rgba(0,0,0,0.2); 
        transform: translateY(0); 
        cursor: pointer; 
        display: inline-block; 
    }
    .btn-3d:active:not(:disabled) { 
        transform: translateY(4px); 
        border-bottom-width: 2px; 
        box-shadow: none; 
    }
    .btn-3d:disabled { opacity: 0.6; cursor: not-allowed; border-bottom-width: 6px; filter: grayscale(100%); }

    /* Animation */
    .shake { animation: shake 0.4s ease-in-out; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
    
    .pop-in { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    /* --- STYLES KHUSUS --- */
    
    /* Display Box Nombor */
    .num-display {
        min-width: 100px; padding: 0.5rem 1rem; 
        border: 3px solid #94a3b8; border-radius: 1rem; 
        font-weight: 700; font-size: 2rem; 
        background-color: #f8fafc; color: #334155;
        display: inline-flex; align-items: center; justify-content: center;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }
    .num-anu { border-color: #3b82f6; background-color: #eff6ff; color: #1d4ed8; border-style: dashed; }
    .num-result { border-color: #22c55e; background-color: #dcfce7; color: #15803d; }

    /* Tangki Air Style */
    .tank-container {
      width: 180px; height: 280px;
      border: 6px solid #475569; border-top: none; border-radius: 0 0 1.5rem 1.5rem;
      background-color: #e2e8f0; margin: 0 auto; position: relative; overflow: hidden;
      box-shadow: inset 4px 4px 10px rgba(0,0,0,0.1);
    }
    .water-level {
      position: absolute; bottom: 0; left: 0; width: 100%;
      background: linear-gradient(to top, #3b82f6, #60a5fa);
      transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex; align-items: flex-end; justify-content: center;
      color: white; font-weight: bold; font-size: 1.2rem; padding-bottom: 8px;
      border-top: 4px solid #93c5fd; opacity: 0.9;
    }
    .tank-marker { position: absolute; left: 100%; width: 140px; margin-left: 10px; border-bottom: 3px dashed #94a3b8; font-size: 0.9rem; font-weight: bold; color: #475569; white-space: nowrap; }

    /* Mesin Songsang Styles - DIKEMASKINI UNTUK SAIZ SERAGAM */
    .machine-box {
      height: 110px; /* Tetapkan tinggi tetap */
      min-width: 110px; /* Lebar minimum */
      padding: 0 15px;
      border: 4px solid #475569; background: white; border-radius: 1.5rem;
      display: flex; align-items: center; justify-content: center;
      font-size: 2.5rem; /* Saiz font besar seragam */
      font-weight: 800; color: #334155;
      box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
    }
    .machine-box.anu { border-style: dashed; background: #fff1f2; color: #e11d48; border-color: #fb7185; }
    .machine-box.result { background: #dcfce7; color: #166534; border-color: #22c55e; }
    .machine-box.op { border-color: #60a5fa; background-color: #eff6ff; color: #2563eb; }

  </style>
</head>
<body class="min-h-screen text-slate-800 pb-10">

  <div class="fixed top-4 left-0 right-0 z-50 px-4 pointer-events-none">
    <div class="max-w-4xl mx-auto bg-green-400 border-4 border-green-600 rounded-full px-6 py-3 shadow-xl flex items-center justify-between pointer-events-auto transform hover:scale-[1.01] transition-transform">
      <div class="flex items-center gap-3">
        <span class="text-3xl animate-bounce">üßÆ</span>
        <span id="info-text" class="text-xl font-bold text-green-900 leading-none mt-1">Mari Belajar 'Anu'!</span>
      </div>
      <button id="speak-btn" onclick="speakInfo()" class="bg-white hover:bg-green-50 text-green-600 border-2 border-green-200 rounded-full p-2 transition-colors shadow-sm">üîä</button>
    </div>
  </div>
  <div class="h-24"></div>

  <div class="max-w-5xl mx-auto p-4">
    
    <div class="game-card p-6 mb-8 flex items-center justify-center">
        <div id="activity-content" class="w-full relative z-10">
            <div class="py-10 text-center">
                <div class="text-8xl mb-6 animate-pulse">‚ùì</div>
                <h2 class="text-5xl font-bold text-emerald-600 mb-4">Cari Nombor Hilang</h2>
                <p class="text-2xl text-slate-500 mb-8 font-semibold">Anu dalam Tambah & Tolak (1-1000)</p>
                <div class="text-4xl animate-bounce">üëá</div>
            </div>
        </div>
    </div>

    <div class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-6 border-2 border-white">
      <h3 class="text-2xl font-bold text-slate-700 mb-4 text-center">üéÆ Pilih Aktiviti</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8">
        <button onclick="loadActivity(1)" class="btn-3d bg-blue-500 text-white font-bold py-4 px-2 rounded-xl text-lg">üîç Cari A+?=C</button>
        <button onclick="loadActivity(2)" class="btn-3d bg-emerald-500 text-white font-bold py-4 px-2 rounded-xl text-lg">üìè Garis Nombor</button>
        <button onclick="loadActivity(3)" class="btn-3d bg-violet-500 text-white font-bold py-4 px-2 rounded-xl text-lg">üíß Tangki Air</button>
        <button onclick="loadActivity(4)" class="btn-3d bg-orange-500 text-white font-bold py-4 px-2 rounded-xl text-lg">‚öñÔ∏è Penimbang</button>
        <button onclick="loadActivity(5)" class="btn-3d bg-rose-500 text-white font-bold py-4 px-2 rounded-xl text-lg">ü§ñ Mesin Songsang</button>
      </div>

      <div class="flex justify-center gap-4 border-t-2 border-slate-100 pt-6">
        <button onclick="clearActivity()" class="btn-3d bg-slate-400 text-white font-bold py-2 px-6 rounded-full text-lg">üè† Menu</button>
        <button onclick="nextActivity()" class="btn-3d bg-indigo-500 text-white font-bold py-2 px-8 rounded-full text-xl">Seterusnya ‚û°Ô∏è</button>
      </div>
    </div>
  </div>

  <script>
    /* --- STANDARD HELPERS --- */
    let currentActivity = 0;
    let ttsEnabled = false;
    let currentInfo = "Pilih aktiviti untuk mula.";
    const r = (min,max) => Math.floor(Math.random()*(max-min+1))+min;

    function triggerWin() { confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } }); }
    
    function speak(text) { 
        if (!ttsEnabled || !('speechSynthesis' in window)) return; 
        window.speechSynthesis.cancel(); 
        const u = new SpeechSynthesisUtterance(text); 
        u.lang = 'ms-MY'; u.rate = 0.9; u.pitch = 1.1; 
        const voices = window.speechSynthesis.getVoices(); 
        const ms = voices.find(v => v.lang === 'ms-MY' || v.lang?.startsWith('ms')); 
        if (ms) u.voice = ms; 
        window.speechSynthesis.speak(u); 
    }
    
    function setInfo(text) { 
        currentInfo = text; 
        const infoEl = document.getElementById('info-text'); 
        infoEl.style.opacity = 0; 
        setTimeout(() => { infoEl.textContent = text; infoEl.style.opacity = 1; }, 200); 
    }
    
    function speakInfo() { 
        if (!ttsEnabled) { 
            ttsEnabled = true; 
            document.getElementById('speak-btn').classList.add('bg-green-100', 'text-green-600'); 
        } 
        speak(currentInfo); 
    }

    /* --- ROUTER --- */
    function loadActivity(n) {
      currentActivity = n;
      const content = document.getElementById('activity-content');
      content.style.opacity = 0;
      setTimeout(() => {
          if (n === 1) loadActivity1(content);
          if (n === 2) loadActivity2(content);
          if (n === 3) loadActivity3(content);
          if (n === 4) loadActivity4(content);
          if (n === 5) loadActivity5(content);
          content.style.opacity = 1;
      }, 200);
    }

    function clearActivity() {
        currentActivity = 0;
        document.getElementById('activity-content').innerHTML = `<div class="py-10 text-center"><div class="text-8xl mb-6 animate-bounce">‚ùì</div><h2 class="text-5xl font-bold text-emerald-600 mb-4">Cari Nombor Hilang</h2><p class="text-2xl text-slate-500 mb-8 font-semibold">Pilih butang di bawah.</p></div>`;
        setInfo("Pilih aktiviti untuk mula.");
    }
    function nextActivity() { let next = currentActivity + 1; if (next > 5) next = 1; loadActivity(next); }

    /* =========================================
       AKTIVITI 1: Cari 'Sebahagian' (A + ? = C)
       ========================================= */
    let a1 = { A: 0, anu: 0, C: 0 };

    function loadActivity1(content) {
        a1.A = r(100, 300); a1.C = r(a1.A + 100, 900); a1.anu = 0;
        setInfo(`Lengkapkan: ${a1.A} tambah berapa jadi ${a1.C}?`);

        content.innerHTML = `
            <h3 class="text-4xl font-bold text-blue-500 mb-8 text-center">üîç Cari Nombor Hilang</h3>
            
            <div class="flex flex-wrap items-center justify-center gap-4 mb-8 text-3xl">
                <div class="num-display">${a1.A}</div>
                <span class="text-slate-400 font-bold">+</span>
                <div id="a1-anu" class="num-display num-anu">${a1.anu}</div>
                <span class="text-slate-400 font-bold">=</span>
                <div class="num-display num-result">${a1.C}</div>
            </div>

            <div class="bg-slate-50 p-6 rounded-2xl border-2 border-slate-200 max-w-2xl mx-auto mb-6">
                <div class="grid grid-cols-3 gap-3 sm:gap-6">
                     <button onclick="adjA1(100)" class="btn-3d bg-blue-400 text-white font-bold py-3 rounded-xl text-xl">+100</button>
                     <button onclick="adjA1(10)" class="btn-3d bg-blue-400 text-white font-bold py-3 rounded-xl text-xl">+10</button>
                     <button onclick="adjA1(1)" class="btn-3d bg-blue-400 text-white font-bold py-3 rounded-xl text-xl">+1</button>
                     
                     <button onclick="adjA1(-100)" class="btn-3d bg-rose-400 text-white font-bold py-3 rounded-xl text-xl">-100</button>
                     <button onclick="adjA1(-10)" class="btn-3d bg-rose-400 text-white font-bold py-3 rounded-xl text-xl">-10</button>
                     <button onclick="adjA1(-1)" class="btn-3d bg-rose-400 text-white font-bold py-3 rounded-xl text-xl">-1</button>
                </div>
            </div>

            <div id="a1-feedback" class="text-2xl font-bold text-slate-500 text-center min-h-[40px]">Jumlah: ${a1.A + a1.anu}</div>
        `;
    }

    function adjA1(val) {
        a1.anu += val;
        if (a1.anu < 0) a1.anu = 0;
        const total = a1.A + a1.anu;
        
        const el = document.getElementById('a1-anu');
        const fb = document.getElementById('a1-feedback');
        el.textContent = a1.anu;
        fb.textContent = `Jumlah: ${total}`;

        if (total === a1.C) {
            fb.innerHTML = `<span class="text-green-600">TEPAT! üéâ</span>`;
            el.classList.remove('num-anu'); el.classList.add('num-result');
            triggerWin(); speak(`Syabas! Jawapannya ialah ${a1.anu}.`);
        } else if (total > a1.C) {
            fb.innerHTML = `<span class="text-rose-500">Terlebih! (${total})</span>`;
            el.classList.add('shake'); setTimeout(()=>el.classList.remove('shake'),400);
        } else {
            el.classList.add('num-anu'); el.classList.remove('num-result');
        }
    }

    /* =========================================
       AKTIVITI 2: Garis Nombor (C - ? = A)
       ========================================= */
    let a2 = { C: 0, anu: 0, A: 0, curr: 0 };

    function loadActivity2(content) {
        a2.C = r(500, 900); a2.A = r(100, a2.C - 200); a2.anu = 0; a2.curr = a2.C;
        setInfo(`Mula di ${a2.C}. Undur sampai nombor jadi ${a2.A}.`);

        content.innerHTML = `
            <h3 class="text-4xl font-bold text-emerald-500 mb-8 text-center">üìè Garis Nombor (Undur)</h3>
            
            <div class="flex flex-wrap items-center justify-center gap-4 mb-8 text-3xl">
                <div class="num-display">${a2.C}</div>
                <span class="text-slate-400 font-bold">-</span>
                <div id="a2-anu" class="num-display num-anu">${a2.anu}</div>
                <span class="text-slate-400 font-bold">=</span>
                <div class="num-display num-result">${a2.A}</div>
            </div>

            <div class="bg-emerald-50 p-6 rounded-2xl border-2 border-emerald-200 max-w-2xl mx-auto mb-6">
                <div class="grid grid-cols-3 gap-3 sm:gap-6">
                     <button onclick="adjA2(100)" class="btn-3d bg-emerald-500 text-white font-bold py-3 rounded-xl text-xl">Undur 100</button>
                     <button onclick="adjA2(10)" class="btn-3d bg-emerald-500 text-white font-bold py-3 rounded-xl text-xl">Undur 10</button>
                     <button onclick="adjA2(1)" class="btn-3d bg-emerald-500 text-white font-bold py-3 rounded-xl text-xl">Undur 1</button>
                     
                     <button onclick="adjA2(-100)" class="btn-3d bg-slate-400 text-white font-bold py-3 rounded-xl text-xl">Maju 100</button>
                     <button onclick="adjA2(-10)" class="btn-3d bg-slate-400 text-white font-bold py-3 rounded-xl text-xl">Maju 10</button>
                     <button onclick="adjA2(-1)" class="btn-3d bg-slate-400 text-white font-bold py-3 rounded-xl text-xl">Maju 1</button>
                </div>
            </div>
            
            <div id="a2-feedback" class="text-2xl font-bold text-slate-500 text-center min-h-[40px]">Lokasi Sekarang: ${a2.curr}</div>
        `;
    }

    function adjA2(val) {
        a2.anu += val;
        if (a2.anu < 0) a2.anu = 0;
        a2.curr = a2.C - a2.anu;

        const el = document.getElementById('a2-anu');
        const fb = document.getElementById('a2-feedback');
        el.textContent = a2.anu;
        fb.textContent = `Lokasi Sekarang: ${a2.curr}`;

        if (a2.curr === a2.A) {
            fb.innerHTML = `<span class="text-emerald-600">SAMPAI! üéâ</span>`;
            el.classList.remove('num-anu'); el.classList.add('num-result');
            triggerWin(); speak(`Betul! Kita undur sebanyak ${a2.anu} langkah.`);
        } else if (a2.curr < a2.A) {
            fb.innerHTML = `<span class="text-rose-500">Terlajak ke belakang! (${a2.curr})</span>`;
            el.classList.add('shake'); setTimeout(()=>el.classList.remove('shake'),400);
        }
    }

    /* =========================================
       AKTIVITI 3: Tangki Air (Isi Semula)
       ========================================= */
    let a3 = { A: 0, B: 0, total: 0, anu: 0 };

    function loadActivity3(content) {
        a3.A = r(100, 300); a3.B = r(200, 500); a3.total = a3.A + a3.B; a3.anu = 0;
        setInfo(`Air tinggal ${a3.B}L. Telah guna ${a3.A}L. Isi balik untuk tahu asal.`);

        content.innerHTML = `
            <h3 class="text-4xl font-bold text-violet-500 mb-4 text-center">üíß Isi Tangki</h3>
            
            <div class="flex flex-wrap items-center justify-center gap-3 mb-8 text-3xl animate-pulse">
                <div id="a3-eqn-anu" class="num-display num-anu">?</div>
                <span class="text-slate-400 font-bold">-</span>
                <div class="num-display text-rose-600 border-rose-200 bg-rose-50">${a3.A}</div>
                <span class="text-slate-400 font-bold">=</span>
                <div class="num-display text-blue-600 border-blue-200 bg-blue-50">${a3.B}</div>
            </div>
            
            <div class="flex flex-row items-end justify-center gap-8 mb-6">
                <div class="tank-container">
                    <div id="a3-water" class="water-level" style="height: ${(a3.B/1000)*280}px;">${a3.B}L</div>
                    <div id="a3-marker-target" class="tank-marker" style="bottom: ${(a3.total/1000)*280}px;">PARAS ASAL (?)</div>
                    <div class="tank-marker" style="bottom: ${(a3.B/1000)*280}px; border-color:#166534; color:#166534;">BAKI (${a3.B}L)</div>
                </div>
                
                <div class="flex flex-col gap-4">
                    <div class="bg-red-100 text-red-800 p-3 rounded-xl font-bold border-2 border-red-200 shadow-sm">
                        Air Keluar: ${a3.A} L
                    </div>
                    <div class="bg-blue-100 text-blue-800 p-3 rounded-xl font-bold border-2 border-blue-200 shadow-sm">
                        Air Masuk: <span id="a3-val" class="text-2xl">0</span> L
                    </div>
                </div>
            </div>

            <div class="flex justify-center gap-3 mb-4">
                 <button onclick="adjA3(100)" class="btn-3d bg-blue-500 text-white font-bold py-2 px-4 rounded-xl">+100L</button>
                 <button onclick="adjA3(10)" class="btn-3d bg-blue-500 text-white font-bold py-2 px-4 rounded-xl">+10L</button>
                 <button onclick="adjA3(1)" class="btn-3d bg-blue-500 text-white font-bold py-2 px-4 rounded-xl">+1L</button>
                 <button onclick="adjA3(-10)" class="btn-3d bg-slate-400 text-white font-bold py-2 px-4 rounded-xl">-10L</button>
            </div>
             <div id="a3-feedback" class="text-xl font-bold text-slate-500 text-center">Berapa paras asal?</div>
        `;
        renderA3(); 
    }

    function adjA3(val) {
        a3.anu += val;
        if (a3.anu < 0) a3.anu = 0;
        renderA3();
    }

    function renderA3() {
        const currentL = a3.B + a3.anu;
        const maxPx = 280; const maxL = 1000;
        
        const water = document.getElementById('a3-water');
        const valEl = document.getElementById('a3-val');
        const fb = document.getElementById('a3-feedback');
        const marker = document.getElementById('a3-marker-target');
        const eqnAnu = document.getElementById('a3-eqn-anu');

        if(!water) return;

        water.style.height = `${(currentL/maxL)*maxPx}px`;
        water.textContent = `${currentL}L`;
        valEl.textContent = a3.anu;

        if (a3.anu === a3.A) {
            fb.innerHTML = `<span class="text-green-600">PARAS ASAL DIJUMPAI! (${currentL}L)</span>`;
            water.style.background = '#22c55e';
            marker.textContent = `PARAS ASAL (${currentL}L)`;
            
            if(eqnAnu) {
                eqnAnu.textContent = currentL;
                eqnAnu.classList.remove('num-anu');
                eqnAnu.classList.add('num-result');
            }
            triggerWin(); speak(`Betul! Paras asal ialah ${currentL} liter.`);
        } else if (a3.anu > a3.A) {
            fb.innerHTML = `<span class="text-rose-500">Melimpah! (Perlu ${a3.A}L shj)</span>`;
            water.style.background = '#ef4444';
            if(eqnAnu) eqnAnu.textContent = "?"; 
        } else {
            fb.textContent = "Terus isi sampai paras asal...";
            water.style.background = 'linear-gradient(to top, #3b82f6, #60a5fa)';
            if(eqnAnu) eqnAnu.textContent = "?";
        }
    }

    /* =========================================
       AKTIVITI 4: Penimbang (A + B = ? + D)
       ========================================= */
    let a4 = { A:0, B:0, D:0, target:0, input:0 };

    function loadActivity4(content) {
        a4.A = r(100,200); a4.B = r(50,150); a4.D = r(50,100);
        a4.target = a4.A + a4.B;
        a4.input = 0;
        setInfo(`Seimbangkan penimbang. Kiri (${a4.target}) mesti sama dengan Kanan.`);

        content.innerHTML = `
            <h3 class="text-4xl font-bold text-orange-500 mb-6 text-center">‚öñÔ∏è Penimbang Seimbang</h3>
            
            <div class="grid grid-cols-2 gap-4 md:gap-8 mb-8 items-stretch">
                <div class="bg-blue-50 border-4 border-blue-200 rounded-2xl p-4 flex flex-col items-center justify-center">
                    <div class="text-slate-500 font-bold mb-2">SASARAN (KIRI)</div>
                    <div class="text-xl mb-2 font-bold text-blue-800">${a4.A} + ${a4.B}</div>
                    <div class="text-5xl font-black text-blue-600">${a4.target}</div>
                </div>

                <div class="bg-orange-50 border-4 border-orange-200 rounded-2xl p-4 flex flex-col items-center justify-center relative">
                    <div class="text-slate-500 font-bold mb-2">CUBAAN (KANAN)</div>
                    <div class="text-xl mb-2 font-bold text-orange-800"><span id="a4-disp-anu" class="text-red-600 text-2xl">0</span> + ${a4.D}</div>
                    <div id="a4-disp-total" class="text-5xl font-black text-orange-600">${a4.D}</div>
                </div>
            </div>

            <div class="flex justify-center flex-wrap gap-3 mb-6">
                 <button onclick="adjA4(100)" class="btn-3d bg-orange-500 text-white font-bold py-3 px-5 rounded-xl">+100</button>
                 <button onclick="adjA4(10)" class="btn-3d bg-orange-500 text-white font-bold py-3 px-5 rounded-xl">+10</button>
                 <button onclick="adjA4(1)" class="btn-3d bg-orange-500 text-white font-bold py-3 px-5 rounded-xl">+1</button>
                 <button onclick="adjA4(-10)" class="btn-3d bg-red-400 text-white font-bold py-3 px-5 rounded-xl">-10</button>
                 <button onclick="adjA4(-1)" class="btn-3d bg-red-400 text-white font-bold py-3 px-5 rounded-xl">-1</button>
            </div>
            <div id="a4-status" class="bg-yellow-100 text-yellow-800 p-3 rounded-xl font-bold text-center border-2 border-yellow-300">
                Belum Seimbang...
            </div>
        `;
    }

    function adjA4(val) {
        a4.input += val;
        if (a4.input < 0) a4.input = 0;
        
        const currentTotal = a4.input + a4.D;
        document.getElementById('a4-disp-anu').textContent = a4.input;
        document.getElementById('a4-disp-total').textContent = currentTotal;
        const stat = document.getElementById('a4-status');

        if (currentTotal === a4.target) {
            stat.className = "bg-green-100 text-green-800 p-3 rounded-xl font-bold text-center border-2 border-green-300";
            stat.textContent = "SEIMBANG! SYABAS!";
            triggerWin(); speak(`Seimbang! Jawapannya ialah ${a4.input}.`);
        } else if (currentTotal > a4.target) {
            stat.className = "bg-red-100 text-red-800 p-3 rounded-xl font-bold text-center border-2 border-red-300";
            stat.textContent = "Berat sebelah Kanan! Kurangkan.";
        } else {
            stat.className = "bg-yellow-100 text-yellow-800 p-3 rounded-xl font-bold text-center border-2 border-yellow-300";
            stat.textContent = "Ringan sebelah Kanan. Tambah lagi.";
        }
    }

    /* =========================================
       AKTIVITI 5: Mesin Songsang
       ========================================= */
    let a5 = { type: 'add', op: 0, res: 0, ans: 0, rev: false };

    function loadActivity5(content) {
        a5.op = r(100,250); a5.res = r(400,800); a5.type = r(0,1)?'add':'sub'; a5.rev = false;
        
        if (a5.type === 'add') {
            a5.ans = a5.res - a5.op; // ? + op = res
        } else {
            a5.ans = a5.res + a5.op; // ? - op = res
        }
        
        setInfo("Tekan butang SONGSANG untuk cari nombor asal.");

        let opSymbol = a5.type==='add' ? '+' : '-';

        content.innerHTML = `
            <h3 class="text-4xl font-bold text-rose-500 mb-6 text-center">ü§ñ Mesin Songsang</h3>
            
            <div class="flex flex-wrap items-center justify-center gap-2 md:gap-4 mb-8 p-6 bg-slate-50 rounded-3xl border-2 border-slate-200 shadow-sm">
                <div class="machine-box anu transform transition hover:scale-105 cursor-default">?</div>
                
                <div class="text-3xl md:text-5xl text-slate-300 animate-pulse">‚ûú</div>
                
                <div class="machine-box op transform transition hover:scale-105 cursor-default">
                    ${opSymbol} ${a5.op}
                </div>
                
                <div class="text-3xl md:text-5xl text-slate-300 animate-pulse">‚ûú</div>
                
                <div class="machine-box transform transition hover:scale-105 cursor-default">${a5.res}</div>
            </div>

            <div id="a5-answer-area" class="hidden pop-in">
                <div class="flex flex-wrap items-center justify-center gap-2 md:gap-4 mb-6 p-6 bg-green-50 rounded-3xl border-2 border-green-200">
                     <div class="machine-box">${a5.res}</div>
                     
                     <div class="text-3xl md:text-5xl text-green-300">‚ûú</div>
                     
                     <div class="machine-box border-green-400 text-green-700 bg-green-100">
                        ${a5.type==='add' ? '-' : '+'} ${a5.op}
                     </div>
                    
                    <div class="text-3xl md:text-5xl text-green-300">‚ûú</div>
                    
                    <div class="machine-box result">${a5.ans}</div>
                </div>
                <div class="text-center text-xl font-bold text-green-700 mb-4">Jawapan: ${a5.ans}</div>
            </div>

            <div class="text-center mt-6">
                <button id="btn-songsang" onclick="revealA5()" class="btn-3d bg-indigo-500 text-white font-bold py-3 px-8 rounded-xl text-2xl shadow-lg hover:bg-indigo-600">üîÑ Songsangkan!</button>
                <button id="btn-new" onclick="loadActivity5(document.getElementById('activity-content'))" class="hidden btn-3d bg-slate-400 text-white font-bold py-3 px-8 rounded-xl text-xl">Soalan Baru</button>
            </div>
        `;
    }

    function revealA5() {
        document.getElementById('a5-answer-area').classList.remove('hidden');
        document.getElementById('btn-songsang').classList.add('hidden');
        document.getElementById('btn-new').classList.remove('hidden');
        triggerWin();
        
        let text = a5.type === 'add' ? 
            `Operasi tambah jadi tolak. ${a5.res} tolak ${a5.op} sama dengan ${a5.ans}.` : 
            `Operasi tolak jadi tambah. ${a5.res} tambah ${a5.op} sama dengan ${a5.ans}.`;
            
        speak(text);
    }

    // Init TTS keepalive
    if ('speechSynthesis' in window) setInterval(() => { if (window.speechSynthesis.paused) window.speechSynthesis.resume(); }, 1000);

  </script>
</body>
</html>
